<metal:module-core
    define-macro="module_core"
    i18n:domain="collective.modules"
    tal:define="checkPermission python:context.restrictedTraverse('portal_membership').checkPermission;
                items python: context.items();
                image_helper nocall: context/@@image_helper;
                plone_view nocall: context/@@plone;">

    <section class="teaser-flow stack-ml teaser-flow-posts push-ml module"
         tal:attributes="id python: 'module_' + context.getId()">
        <div tal:condition="python: context.title or context.description">
            <h3 class="strong sans-h6 a-center" tal:condition="python: context.title" tal:content="python: context.title">Title</h3>
            <h4 class="module__subtitle strong a-center" tal:condition="python: context.description" tal:content="python: context.description">Description</h4>

            <p class="module__text" tal:condition="python: context.text" tal:content="structure python: context.text.output">Text</p>

        </div>

        <div class="stop">

            <ol class="flow-ml flickity-flow">

              <tal:item tal:repeat="item python: items">
                <li class="teaser-item teaser-item-post">

                    <div class="dynajet-image"
                         tal:define="image_url python: image_helper.image_url(item)"
                         tal:condition="python: image_url"
                         tal:replace="nothing">
                      <a tal:attributes="href python: item.absolute_url();
                                         title python: item.title;">
                        <img class="d-block wh-100"
                             src="/++plone++dynajet.site/tmp/dynajet-500me.jpg"
                             alt="Dynajet 500me"
                             tal:attributes="src python: image_url;
                                             alt python: item.title;">
                      </a>
                    </div>

                <a tal:attributes="href python: item.absolute_url();
                                   title python: item.title;">
                <div class="link-outer stack-xs">
                    <div class="stack-xxs">
                        <p tal:content="python: plone_view.cropText(item.title, 48)">Überraschende Erkenntnis</p>
                        <h4 class="sans-t2 strong" tal:content="python: plone_view.cropText(item.description, 102)">Falsche Vorstellungen von den Zusammenhängen in der Natur halten sich bei Kindern oft hartnäckig.  Eine Studie zeigt jetzt: Experimente mit überraschendem Ausgang helfen, diese nachhaltig zu korrigieren.   </h4>
                    </div>
                    <p class="teaser-link sans-m2 strong">
                        <span class="btn-link btn-s btn-icon-left trim">
                            <span class="text" tal:content="python: context.link_text">mehr lesen</span>
                        </span>
                    </p>
                </div>
                </a>

                </li>
              </tal:item>

            </ol>

            <div tal:condition="python: checkPermission('Modify portal content', context)">
                <a class="btn btn-primary btn-sm float-right" data-pat-plone-modal="width: 100%"
                   tal:condition="python: checkPermission('Modify portal content', context)"
                   tal:attributes="href python: context.absolute_url() + '/edit'">
                    Edit Module
                </a>
            </div>
        </div>
    </section>

</metal:module-core>
